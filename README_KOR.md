# OS 과제 2: 멀티 스레드 단어 세기

제출 기한: 10월 19일

두 번째 과제는 멀티 스레드 프로그래밍과 동기화에 관한 것입니다. 스레드는 실행의 단위이며, 스레드는 레지스터, 스택과 같은 실행 컨텍스트를 가집니다. 중요한 점은, 스레드는 동일한 프로세스 내에서 주소 공간(메모리)을 공유한다는 것입니다. 따라서 스레드 간 메모리 접근에 대해 명확한 분리 및 보호가 없습니다.

제공된 예시 코드는 멀티 스레드를 사용하는 기본적인 코드입니다. 기본적으로 파일을 읽고 화면에 출력하는 작업을 합니다. 이 코드는 세 개의 스레드로 구성됩니다:

- 메인 스레드: 관리자 역할을 담당합니다.
- 프로듀서 스레드: 파일에서 한 줄씩 읽어와 공유 버퍼에 문자열을 넣습니다.
- 컨슈머 스레드: 공유 버퍼에서 문자열을 가져와 화면에 출력합니다.

- 불행히도, 이 코드는 현재 올바르게 동작하지 않습니다. 스레드들이 서로 독립적으로 실행되기 때문에 다른 스레드들이 유효하지 않은 메모리에 접근하거나 잘못된 값을 가지거나, 무한 대기 상태에 빠져 프로그램이 충돌합니다. 이를 해결하기 위해서는 각 스레드가 올바른 값을 가지도록 코드에 수정이 필요합니다.

스레드에서 올바른 값을 얻기 위해서는 여러 스레드가 접근하는 데이터를 일관성 있게 유지해야 합니다. 이를 위해서는 스레드 간의 실행을 신중하게 제어해야 하며, 이를 **동기화(synchronization)**라고 합니다.

- pthread_mutex_lock() / pthread_mutex_unlock()는 스레드 동기화를 위한 함수입니다.
- pthread_cond_wait() / pthread_cond_signal()와 같은 함수는 조건 변수에 대해 알아보는 것이 좋습니다.
과제 목표는 다음과 같습니다:

prod_cons.c 코드를 수정하여 1개의 프로듀서와 1개의 컨슈머가 있는 경우 올바르게 동작하도록 하십시오.
여러 컨슈머를 지원할 수 있도록 개선하십시오.
컨슈머들이 주어진 텍스트 파일에 대해 통계를 수집하도록 만드십시오. 기본적으로, 한 줄의 문자열에서 각 알파벳 문자의 개수를 셉니다. char_stat.c 파일이 통계 수집에 대한 힌트가 될 수 있습니다. 프로그램 실행이 종료되면 전체 텍스트에 대한 통계를 출력해야 합니다. 최대한 병행성을 높여 최신성을 유지하면서 가장 빠른 실행 시간을 달성하세요!
프로그램을 실행할 때는, 읽을 파일명과 프로듀서와 컨슈머의 개수를 지정할 수 있습니다. 예를 들어, sample file을 읽는 1개의 프로듀서와 2개의 컨슈머가 있을 때, 다음과 같이 프로그램을 실행할 수 있습니다:

```bash
./prod_cons ./sample 1 2
```

다음 링크에서 예시 입력 소스 코드를 다운로드할 수 있습니다: [http://mobile-os.dankook.ac.kr/data/FreeBSD9-orig.tar] 또는 /opt/FreeBSD9-orig.tar를 서버에서 사용할 수 있습니다.

프로그램 빌드/컴파일 및 실행 방법을 설명하는 문서를 작성하십시오. 해당 문서에는 프로그램의 간단한 소개와 구현 세부사항이 포함되어 있어야 합니다. 프로그램 구조에 대한 중요한 부분도 설명하는 것이 좋습니다.

실행 시간을 측정하려면 clock_gettime() 또는 gettimeofday()를 고려하십시오.

htop은 시스템에서 스레드의 실행을 보여주는 프로그램입니다.

다양한 스레드 수에 대한 실행 시간을 측정 및 비교하십시오.

즐거운 해킹 되세요! Seehwan